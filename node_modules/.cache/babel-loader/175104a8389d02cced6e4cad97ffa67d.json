{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.supportsZeroByteGCM = exports.supportsSubtleCrypto = exports.supportsSecureRandom = exports.supportsWebCrypto = void 0;\nvar tslib_1 = require(\"tslib\");\nvar subtleCryptoMethods = [\"decrypt\", \"digest\", \"encrypt\", \"exportKey\", \"generateKey\", \"importKey\", \"sign\", \"verify\"];\nfunction supportsWebCrypto(window) {\n  if (supportsSecureRandom(window) && typeof window.crypto.subtle === \"object\") {\n    var subtle = window.crypto.subtle;\n    return supportsSubtleCrypto(subtle);\n  }\n  return false;\n}\nexports.supportsWebCrypto = supportsWebCrypto;\nfunction supportsSecureRandom(window) {\n  if (typeof window === \"object\" && typeof window.crypto === \"object\") {\n    var getRandomValues = window.crypto.getRandomValues;\n    return typeof getRandomValues === \"function\";\n  }\n  return false;\n}\nexports.supportsSecureRandom = supportsSecureRandom;\nfunction supportsSubtleCrypto(subtle) {\n  return subtle && subtleCryptoMethods.every(function (methodName) {\n    return typeof subtle[methodName] === \"function\";\n  });\n}\nexports.supportsSubtleCrypto = supportsSubtleCrypto;\nfunction supportsZeroByteGCM(subtle) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var key, zeroByteAuthTag, _a;\n    return tslib_1.__generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          if (!supportsSubtleCrypto(subtle)) return [2 /*return*/, false];\n          _b.label = 1;\n        case 1:\n          _b.trys.push([1, 4,, 5]);\n          return [4 /*yield*/, subtle.generateKey({\n            name: \"AES-GCM\",\n            length: 128\n          }, false, [\"encrypt\"])];\n        case 2:\n          key = _b.sent();\n          return [4 /*yield*/, subtle.encrypt({\n            name: \"AES-GCM\",\n            iv: new Uint8Array(Array(12)),\n            additionalData: new Uint8Array(Array(16)),\n            tagLength: 128\n          }, key, new Uint8Array(0))];\n        case 3:\n          zeroByteAuthTag = _b.sent();\n          return [2 /*return*/, zeroByteAuthTag.byteLength === 16];\n        case 4:\n          _a = _b.sent();\n          return [2 /*return*/, false];\n        case 5:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\nexports.supportsZeroByteGCM = supportsZeroByteGCM;","map":{"version":3,"sources":["../src/supportsWebCrypto.ts"],"names":[],"mappings":";;;;;;;AAUA,IAAM,mBAAmB,GAA8B,CACrD,SAAS,EACT,QAAQ,EACR,SAAS,EACT,WAAW,EACX,aAAa,EACb,WAAW,EACX,MAAM,EACN,QAAQ,CACT;AAED,SAAgB,iBAAiB,CAAC,MAAc,EAAA;EAC9C,IACE,oBAAoB,CAAC,MAAM,CAAC,IAC5B,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,KAAK,QAAQ,EACxC;IACQ,IAAA,MAAM,GAAK,MAAM,CAAC,MAAM,CAAA,MAAlB;IAEd,OAAO,oBAAoB,CAAC,MAAM,CAAC;EACpC;EAED,OAAO,KAAK;AACd;AAXA,OAAA,CAAA,iBAAA,GAAA,iBAAA;AAaA,SAAgB,oBAAoB,CAAC,MAAc,EAAA;EACjD,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,OAAO,MAAM,CAAC,MAAM,KAAK,QAAQ,EAAE;IAC3D,IAAA,eAAe,GAAK,MAAM,CAAC,MAAM,CAAA,eAAlB;IAEvB,OAAO,OAAO,eAAe,KAAK,UAAU;EAC7C;EAED,OAAO,KAAK;AACd;AARA,OAAA,CAAA,oBAAA,GAAA,oBAAA;AAUA,SAAgB,oBAAoB,CAAC,MAAoB,EAAA;EACvD,OACE,MAAM,IACN,mBAAmB,CAAC,KAAK,CACvB,UAAA,UAAU,EAAA;IAAI,OAAA,OAAO,MAAM,CAAC,UAAU,CAAC,KAAK,UAAU;EAAxC,CAAwC,CACvD;AAEL;AAPA,OAAA,CAAA,oBAAA,GAAA,oBAAA;AASA,SAAsB,mBAAmB,CAAC,MAAoB,EAAA;;;;;;UAC5D,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,EAAE,OAAA,CAAA,CAAA,CAAA,YAAO,KAAK,CAAA;;;;UAEjC,OAAA,CAAA,CAAA,CAAA,WAAM,MAAM,CAAC,WAAW,CAClC;YAAE,IAAI,EAAE,SAAS;YAAE,MAAM,EAAE;UAAG,CAAE,EAChC,KAAK,EACL,CAAC,SAAS,CAAC,CACZ,CAAA;;UAJK,GAAG,GAAG,EAAA,CAAA,IAAA,EAIX;UACuB,OAAA,CAAA,CAAA,CAAA,WAAM,MAAM,CAAC,OAAO,CAC1C;YACE,IAAI,EAAE,SAAS;YACf,EAAE,EAAE,IAAI,UAAU,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YAC7B,cAAc,EAAE,IAAI,UAAU,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YACzC,SAAS,EAAE;WACZ,EACD,GAAG,EACH,IAAI,UAAU,CAAC,CAAC,CAAC,CAClB,CAAA;;UATK,eAAe,GAAG,EAAA,CAAA,IAAA,EASvB;UACD,OAAA,CAAA,CAAA,CAAA,YAAO,eAAe,CAAC,UAAU,KAAK,EAAE,CAAA;;;UAExC,OAAA,CAAA,CAAA,CAAA,YAAO,KAAK,CAAA;;;;;;AAEf;;AAtBD,OAAA,CAAA,mBAAA,GAAA,mBAAA","sourcesContent":["type SubtleCryptoMethod =\n  | \"decrypt\"\n  | \"digest\"\n  | \"encrypt\"\n  | \"exportKey\"\n  | \"generateKey\"\n  | \"importKey\"\n  | \"sign\"\n  | \"verify\";\n\nconst subtleCryptoMethods: Array<SubtleCryptoMethod> = [\n  \"decrypt\",\n  \"digest\",\n  \"encrypt\",\n  \"exportKey\",\n  \"generateKey\",\n  \"importKey\",\n  \"sign\",\n  \"verify\"\n];\n\nexport function supportsWebCrypto(window: Window): boolean {\n  if (\n    supportsSecureRandom(window) &&\n    typeof window.crypto.subtle === \"object\"\n  ) {\n    const { subtle } = window.crypto;\n\n    return supportsSubtleCrypto(subtle);\n  }\n\n  return false;\n}\n\nexport function supportsSecureRandom(window: Window): boolean {\n  if (typeof window === \"object\" && typeof window.crypto === \"object\") {\n    const { getRandomValues } = window.crypto;\n\n    return typeof getRandomValues === \"function\";\n  }\n\n  return false;\n}\n\nexport function supportsSubtleCrypto(subtle: SubtleCrypto) {\n  return (\n    subtle &&\n    subtleCryptoMethods.every(\n      methodName => typeof subtle[methodName] === \"function\"\n    )\n  );\n}\n\nexport async function supportsZeroByteGCM(subtle: SubtleCrypto) {\n  if (!supportsSubtleCrypto(subtle)) return false;\n  try {\n    const key = await subtle.generateKey(\n      { name: \"AES-GCM\", length: 128 },\n      false,\n      [\"encrypt\"]\n    );\n    const zeroByteAuthTag = await subtle.encrypt(\n      {\n        name: \"AES-GCM\",\n        iv: new Uint8Array(Array(12)),\n        additionalData: new Uint8Array(Array(16)),\n        tagLength: 128\n      },\n      key,\n      new Uint8Array(0)\n    );\n    return zeroByteAuthTag.byteLength === 16;\n  } catch {\n    return false;\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}